<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pizzer√≠a Premium | Delivery</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            /* Nueva Paleta de Colores */
            --primary: #ff4757;
            --primary-dark: #e84148;
            --accent: #ffa502;
            --bg-dark: #0f1014;
            --bg-card: #1b1e26;
            --bg-sidebar: #15171e;
            --text-main: #ffffff;
            --text-secondary: #a0a3bd;
            --border: rgba(255, 255, 255, 0.08);
            --success: #2ed573;
            --shadow: 0 10px 30px rgba(0,0,0,0.3);
            --radius: 16px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background-color: var(--bg-dark); 
            background-image: radial-gradient(circle at top right, #1e222b 0%, var(--bg-dark) 60%);
            color: var(--text-main); 
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: 80px; /* Espacio para m√≥vil */
        }

        /* --- HEADER MODERNO --- */
        header {
            background: rgba(15, 16, 20, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            padding: 1rem 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid var(--border);
        }
        .brand { display: flex; flex-direction: column; }
        .logo { font-size: 1.25rem; font-weight: 700; color: var(--text-main); letter-spacing: -0.5px; }
        .logo span { color: var(--primary); }
        
        .status-badge {
            font-size: 0.7rem;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 3px 10px;
            border-radius: 20px;
            background: rgba(255,255,255,0.05);
            width: fit-content;
            margin-top: 2px;
        }
        .status-open { color: var(--success); border: 1px solid rgba(46, 213, 115, 0.2); }
        .status-closed { color: var(--primary); border: 1px solid rgba(255, 71, 87, 0.2); }
        .status-dot { width: 6px; height: 6px; border-radius: 50%; background: currentColor; box-shadow: 0 0 8px currentColor; }

        .cart-trigger {
            position: relative;
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            transition: 0.3s;
            border: 1px solid var(--border);
        }
        .cart-trigger:active { transform: scale(0.9); background: rgba(255,255,255,0.1); }
        
        #cart-count {
            position: absolute;
            top: -2px;
            right: -2px;
            background: var(--primary);
            color: white;
            font-size: 0.7rem;
            font-weight: 700;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 2px solid var(--bg-dark);
        }

        /* --- CATEGOR√çAS SCROLL --- */
        .categories-wrapper {
            position: sticky;
            top: 70px;
            z-index: 900;
            padding: 15px 5%;
            background: rgba(15, 16, 20, 0.9);
            backdrop-filter: blur(5px);
        }
        .categories-nav {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding-bottom: 5px;
            scrollbar-width: none; /* Firefox */
        }
        .categories-nav::-webkit-scrollbar { display: none; } /* Chrome/Safari */
        
        .cat-btn {
            background: var(--bg-card);
            color: var(--text-secondary);
            border: 1px solid var(--border);
            padding: 8px 20px;
            border-radius: 30px;
            cursor: pointer;
            white-space: nowrap;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .cat-btn.active { 
            background: var(--primary); 
            color: white; 
            border-color: var(--primary);
            box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3);
        }

        /* --- GRID Y TARJETAS --- */
        .container { max-width: 1200px; margin: 0 auto; padding: 10px 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; margin-top: 20px; }
        
        .pizza-card { 
            background: var(--bg-card); 
            border-radius: var(--radius); 
            overflow: hidden; 
            border: 1px solid var(--border); 
            transition: transform 0.3s, box-shadow 0.3s;
            display: flex;
            flex-direction: column;
        }
        .pizza-card:hover { 
            transform: translateY(-5px); 
            box-shadow: var(--shadow); 
            border-color: rgba(255,255,255,0.15);
        }
        .pizza-card.hidden { display: none; }
        
        .img-wrapper { position: relative; height: 180px; overflow: hidden; }
        .pizza-img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        .pizza-card:hover .pizza-img { transform: scale(1.05); }

        .pizza-info { padding: 20px; flex: 1; display: flex; flex-direction: column; }
        .pizza-info h3 { font-size: 1.1rem; margin-bottom: 5px; color: var(--text-main); }
        .pizza-info p { font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 15px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        
        /* Estilos de Opciones */
        .options-group { margin-top: auto; background: rgba(0,0,0,0.2); padding: 12px; border-radius: 12px; border: 1px solid var(--border); }
        .options-group label { display: block; font-size: 0.75rem; color: var(--accent); margin-bottom: 5px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        
        select { 
            width: 100%; 
            background: var(--bg-dark); 
            color: var(--text-main); 
            border: 1px solid var(--border); 
            padding: 10px; 
            border-radius: 8px; 
            font-size: 0.9rem; 
            outline: none; 
            cursor: pointer;
            appearance: none; /* Eliminar flecha por defecto */
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23a0a3bd%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right 12px top 50%;
            background-size: 10px auto;
        }
        
        .extras-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
        .extra-option { font-size: 0.8rem; display: flex; align-items: center; gap: 8px; cursor: pointer; color: var(--text-secondary); user-select: none; }
        .extra-option input { accent-color: var(--primary); width: 16px; height: 16px; }

        .price-tag { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border); }
        
        .add-btn { 
            background: var(--primary); 
            color: white; 
            border: none; 
            padding: 10px 24px; 
            border-radius: 10px; 
            cursor: pointer; 
            font-weight: 600; 
            font-size: 0.9rem;
            transition: all 0.2s;
            box-shadow: 0 4px 15px rgba(255, 71, 87, 0.25);
        }
        .add-btn:hover { background: var(--primary-dark); transform: translateY(-1px); }
        .add-btn:active { transform: translateY(1px); }

        /* --- TOAST NOTIFICATION --- */
        #toast { 
            position: fixed; 
            bottom: 30px; 
            left: 50%; 
            transform: translateX(-50%) translateY(100px); 
            background: rgba(46, 213, 115, 0.95); 
            backdrop-filter: blur(4px);
            color: #fff; 
            padding: 12px 24px; 
            border-radius: 50px; 
            z-index: 6000; 
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            font-weight: 600;
            font-size: 0.9rem;
            box-shadow: 0 10px 30px rgba(46, 213, 115, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        #toast.show { transform: translateX(-50%) translateY(0); }

        /* --- CARRITO SIDEBAR & OVERLAY --- */
        .cart-backdrop {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(4px);
            z-index: 1999; opacity: 0; pointer-events: none; transition: 0.3s;
        }
        .cart-backdrop.active { opacity: 1; pointer-events: all; }

        .cart-overlay { 
            position: fixed; 
            top: 0; 
            right: -100%; 
            width: 100%; 
            max-width: 420px; 
            height: 100%; 
            background: var(--bg-sidebar); 
            z-index: 2000; 
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
            display: flex; 
            flex-direction: column; 
            box-shadow: -10px 0 40px rgba(0,0,0,0.5);
        }
        .cart-overlay.active { right: 0; }

        .cart-header { 
            padding: 20px 25px; 
            border-bottom: 1px solid var(--border); 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            background: rgba(255,255,255,0.02);
        }
        .cart-header h3 { font-size: 1.2rem; }
        .close-cart { 
            background: rgba(255,255,255,0.05); 
            border: none; 
            color: var(--text-secondary); 
            width: 36px; height: 36px; 
            border-radius: 50%; 
            cursor: pointer; 
            display: flex; align-items: center; justify-content: center;
            transition: 0.2s;
        }
        .close-cart:hover { background: rgba(255,255,255,0.1); color: white; }

        .cart-body { flex: 1; padding: 20px; overflow-y: auto; }
        .cart-item { 
            background: rgba(255,255,255,0.03); 
            padding: 15px; 
            border-radius: 12px; 
            margin-bottom: 12px; 
            position: relative; 
            border: 1px solid transparent;
            transition: 0.2s;
        }
        .cart-item:hover { border-color: rgba(255,255,255,0.05); background: rgba(255,255,255,0.04); }
        
        .remove-item { 
            position: absolute; 
            top: 10px; 
            right: 10px; 
            color: var(--text-secondary); 
            cursor: pointer; 
            font-size: 0.8rem;
            padding: 5px;
            transition: 0.2s;
        }
        .remove-item:hover { color: var(--primary); }

        .cart-footer { padding: 25px; background: var(--bg-card); border-top: 1px solid var(--border); border-radius: 20px 20px 0 0; }
        .total-row { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 20px; 
            font-size: 1.2rem; 
            font-weight: 700; 
        }
        .total-row span:last-child { color: var(--accent); }

        /* --- FORMULARIO --- */
        #order-form { display: none; flex-direction: column; gap: 15px; margin-top: 15px; animation: slideDown 0.3s ease; }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .input-group { position: relative; }
        input { 
            width: 100%; 
            padding: 14px 15px; 
            border-radius: 12px; 
            border: 1px solid var(--border); 
            background: rgba(0,0,0,0.2); 
            color: white; 
            font-size: 0.95rem; 
            outline: none; 
            transition: 0.3s;
        }
        input:focus { border-color: var(--primary); background: rgba(0,0,0,0.4); box-shadow: 0 0 0 4px rgba(255, 71, 87, 0.1); }
        input.error { border-color: var(--primary); animation: shake 0.4s; }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        #whatsapp-btn { 
            display: none; 
            background: #25d366; 
            color: white; 
            text-align: center; 
            padding: 16px; 
            border-radius: 12px; 
            text-decoration: none; 
            font-weight: 700; 
            font-size: 1rem;
            box-shadow: 0 8px 20px rgba(37, 211, 102, 0.3);
            transition: 0.2s;
        }
        #whatsapp-btn:hover { transform: translateY(-2px); box-shadow: 0 12px 25px rgba(37, 211, 102, 0.4); }

        .btn-next { 
            width: 100%; 
            padding: 16px; 
            background: var(--accent); 
            border: none; 
            border-radius: 12px; 
            font-weight: 700; 
            cursor: pointer; 
            font-size: 1rem;
            color: #000;
            transition: 0.2s;
        }
        .btn-next:hover { filter: brightness(1.1); }
    </style>
</head>
<body>

<header>
    <div class="brand">
        <div class="logo">üçï Pizza<span>Cubana</span></div>
        <div id="business-status" class="status-badge"></div>
    </div>
    <div class="cart-trigger" onclick="toggleCart()">
        <i class="fas fa-shopping-bag" style="font-size: 1.2rem; color: var(--text-main);"></i>
        <span id="cart-count">0</span>
    </div>
</header>

<div class="categories-wrapper">
    <nav class="categories-nav">
        <button class="cat-btn active" onclick="filterCategory('todas', this)">Todas</button>
        <button class="cat-btn" onclick="filterCategory('pizzas', this)">Pizzas</button>
        <button class="cat-btn" onclick="filterCategory('entrantes', this)">Entrantes</button>
        <button class="cat-btn" onclick="filterCategory('bebidas', this)">Bebidas</button>
    </nav>
</div>

<div class="container">
    <div class="grid" id="menu-grid">
        
        <!-- PRODUCTO 1: PIZZA -->
        <div class="pizza-card" data-category="pizzas" data-name="Pizza Napolitana">
            <div class="img-wrapper">
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTJrciWk89zIsYeLZnR73vq43QcPIwKGrNcQQ&s" class="pizza-img" alt="Pizza Napolitana">
            </div>
            <div class="pizza-info">
                <h3>Pizza Napolitana</h3>
                <p>Salsa de la casa y doble queso.</p>
                <div class="options-group">
                    <label>Tama√±o:</label>
                    <select class="size-select">
                        <option value="Personal" data-price="800">Personal - 800 CUP</option>
                        <option value="Mediana" data-price="1200">Mediana - 1200 CUP</option>
                        <option value="Familiar" data-price="1800">Familiar - 1800 CUP</option>
                    </select>
                    <label style="margin-top:10px">Extras:</label>
                    <div class="extras-grid">
                        <label class="extra-option"><input type="checkbox" value="Queso" data-price="250"> Queso (+250)</label>
                        <label class="extra-option"><input type="checkbox" value="Jam√≥n" data-price="200"> Jam√≥n (+200)</label>
                    </div>
                </div>
                <div class="price-tag">
                    <span></span>
                    <button class="add-btn" onclick="addToCart(this)">A√±adir</button>
                </div>
            </div>
        </div>

        <!-- PRODUCTO 2: PIZZA -->
        <div class="pizza-card" data-category="pizzas" data-name="Pepperoni Supreme">
            <div class="img-wrapper">
                <img src="https://images.unsplash.com/photo-1628840042765-356cda07504e?w=500" class="pizza-img" alt="Pepperoni">
            </div>
            <div class="pizza-info">
                <h3>Pepperoni Supreme</h3>
                <p>Cargada de Pepperoni crujiente.</p>
                <div class="options-group">
                    <label>Tama√±o:</label>
                    <select class="size-select">
                        <option value="Personal" data-price="1000">Personal - 1000 CUP</option>
                        <option value="Mediana" data-price="1500">Mediana - 1500 CUP</option>
                        <option value="Familiar" data-price="2200">Familiar - 2200 CUP</option>
                    </select>
                </div>
                <div class="price-tag">
                    <span></span>
                    <button class="add-btn" onclick="addToCart(this)">A√±adir</button>
                </div>
            </div>
        </div>

        <!-- PRODUCTO 3: ENTRANTE -->
        <div class="pizza-card" data-category="entrantes" data-name="Pizza Hawaiana">
            <div class="img-wrapper">
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS8W_bMXGMSIDWSfXNLGkT3f5lLTJrNKvgByw&s" class="pizza-img" alt="Hawaiana">
            </div>
            <div class="pizza-info">
                <h3>Pizza Hawaiana</h3>
                <p>Combina sabores dulces y salados, con pi√±a fresca y jam√≥n.</p>
                <div class="price-tag">
                    <span style="color:var(--text-main); font-weight:600; font-size:1.1rem" data-single-price="450">450 CUP</span>
                    <button class="add-btn" onclick="addToCart(this)">A√±adir</button>
                </div>
            </div>
        </div>

        <!-- PRODUCTO 4: BEBIDA -->
        <div class="pizza-card" data-category="bebidas" data-name="Refresco Lata">
            <div class="img-wrapper">
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRK0UZoSk-dmb2Etz_nZBIr1Ib1GUb9uvAYGw&s" class="pizza-img" alt="Refresco">
            </div>
            <div class="pizza-info">
                <h3>Refresco Lata</h3>
                <p>Sabor sujeto a disponibilidad.</p>
                <div class="price-tag">
                    <span style="color:var(--text-main); font-weight:600; font-size:1.1rem" data-single-price="250">250 CUP</span>
                    <button class="add-btn" onclick="addToCart(this)">A√±adir</button>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- Notificaci√≥n Flotante -->
<div id="toast"><i class="fas fa-check-circle"></i> Producto a√±adido</div>

<!-- Overlay Oscuro -->
<div class="cart-backdrop" id="cart-backdrop" onclick="toggleCart()"></div>

<!-- Carrito Sidebar -->
<div class="cart-overlay" id="cart-sidebar">
    <div class="cart-header">
        <h3>Mi Pedido</h3>
        <button class="close-cart" onclick="toggleCart()"><i class="fas fa-times"></i></button>
    </div>
    
    <div class="cart-body" id="cart-items">
        <!-- Los items se inyectan aqu√≠ -->
        <div style="text-align:center; padding-top: 40px; color:var(--text-secondary);">
            <i class="fas fa-shopping-basket" style="font-size: 2rem; margin-bottom: 15px; opacity: 0.5;"></i>
            <p>Tu carrito est√° vac√≠o</p>
        </div>
    </div>

    <div class="cart-footer">
        <div class="total-row">
            <span>Total:</span>
            <span id="total-price">0 CUP</span>
        </div>
        
        <button class="btn-next" onclick="showForm()" id="btn-next-step">CONTINUAR PEDIDO</button>

        <form id="order-form">
            <div class="input-group">
                <input type="text" id="name" placeholder="Nombre Completo" oninput="validateForm()">
            </div>
            <div class="input-group">
                <input type="text" id="address" placeholder="Direcci√≥n de Entrega" oninput="validateForm()">
            </div>
            <div class="input-group">
                <input type="text" id="landmark" placeholder="Punto de Referencia (Entre calles...)" oninput="validateForm()">
            </div>
            <div class="input-group">
                <input type="tel" id="phone" placeholder="+53 5xxxxxxx" oninput="validateForm()">
            </div>
            
            <a id="whatsapp-btn" href="#" target="_blank">
                <i class="fab fa-whatsapp"></i> Enviar a WhatsApp
            </a>
        </form>
    </div>
</div>

<script>
    const WHATSAPP_NUMBER = "5353910527";
    let cart = [];

    // --- L√ìGICA DE FILTRADO (Mantenida) ---
    function filterCategory(cat, btn) {
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        document.querySelectorAll('.pizza-card').forEach(card => {
            if(cat === 'todas' || card.dataset.category === cat) {
                card.classList.remove('hidden');
            } else {
                card.classList.add('hidden');
            }
        });
    }

    // --- A√ëADIR AL CARRITO (Mantenida y adaptada) ---
    function addToCart(btn) {
        const card = btn.closest('.pizza-card');
        const name = card.dataset.name;
        const sizeSelect = card.querySelector('.size-select');
        
        let basePrice = 0;
        let sizeName = "";
        let selectedExtras = [];

        if(sizeSelect) {
            const selectedOption = sizeSelect.options[sizeSelect.selectedIndex];
            basePrice = parseInt(selectedOption.dataset.price);
            sizeName = selectedOption.value;
            
            // Extras
            card.querySelectorAll('input[type="checkbox"]:checked').forEach(chk => {
                selectedExtras.push({
                    nombre: chk.parentElement.textContent.trim().split(' (')[0],
                    precio: parseInt(chk.dataset.price)
                });
                chk.checked = false; // reset para el pr√≥ximo
            });
        } else {
            basePrice = parseInt(card.querySelector('[data-single-price]').dataset.singlePrice);
        }

        cart.push({
            uniqueId: Date.now(),
            nombre: name,
            tamano: sizeName,
            precioBase: basePrice,
            extras: selectedExtras
        });

        updateCartUI();
        showToast();
        
        // Abrir el carrito autom√°ticamente al a√±adir
        const sidebar = document.getElementById('cart-sidebar');
        if (!sidebar.classList.contains('active')) {
            toggleCart();
        }
    }

    function updateCartUI() {
        const container = document.getElementById('cart-items');
        const count = document.getElementById('cart-count');
        const totalEl = document.getElementById('total-price');
        
        count.innerText = cart.length;
        let totalGeneral = 0;

        if(cart.length === 0) {
            container.innerHTML = `
                <div style="text-align:center; padding-top: 40px; color:var(--text-secondary);">
                    <i class="fas fa-shopping-basket" style="font-size: 2rem; margin-bottom: 15px; opacity: 0.5;"></i>
                    <p>Tu carrito est√° vac√≠o</p>
                </div>`;
            totalEl.innerText = "0 CUP";
            // Ocultar bot√≥n de continuar y formulario si est√° vac√≠o
            document.getElementById('btn-next-step').style.display = 'block';
            document.getElementById('order-form').style.display = 'none';
            return;
        }

        container.innerHTML = cart.map(item => {
            const extrasTotal = item.extras.reduce((sum, ex) => sum + ex.precio, 0);
            const itemFinalPrice = item.precioBase + extrasTotal;
            totalGeneral += itemFinalPrice;

            return `
                <div class="cart-item">
                    <i class="fas fa-trash-alt remove-item" onclick="removeFromCart(${item.uniqueId})"></i>
                    <div style="font-weight:600; font-size:0.95rem; color:white; margin-bottom:4px;">${item.nombre}</div>
                    <div style="font-size:0.85rem; color:var(--text-secondary); margin-bottom:4px;">
                        ${item.tamano ? `<span style="background:rgba(255,255,255,0.1); padding:2px 6px; border-radius:4px; font-size:0.75rem;">${item.tamano}</span>` : ''}
                    </div>
                    ${item.extras.length > 0 ? `
                        <div style="font-size:0.75rem; color:var(--text-secondary); margin-bottom:4px;">
                            + ${item.extras.map(e => e.nombre).join(', ')}
                        </div>
                    ` : ''}
                    <div style="color:var(--accent); font-weight:700; font-size:0.95rem; text-align:right;">${itemFinalPrice} CUP</div>
                </div>
            `;
        }).join('');

        totalEl.innerText = `${totalGeneral} CUP`;
        validateForm();
    }

    function removeFromCart(uid) {
        cart = cart.filter(i => i.uniqueId !== uid);
        updateCartUI();
    }

    // --- CONTROL DE VISTAS (Carrito/Formulario) ---
    function toggleCart() {
        document.getElementById('cart-sidebar').classList.toggle('active');
        document.getElementById('cart-backdrop').classList.toggle('active');
    }

    function showForm() {
        if(cart.length === 0) return;
        document.getElementById('order-form').style.display = 'flex';
        document.getElementById('btn-next-step').style.display = 'none';
        // Scroll al fondo del carrito
        setTimeout(() => {
            document.querySelector('.cart-footer').scrollIntoView({ behavior: 'smooth' });
        }, 100);
    }

    // --- VALIDACI√ìN Y WHATSAPP ---
    function validateForm() {
        const name = document.getElementById('name').value.trim();
        const addr = document.getElementById('address').value.trim();
        const land = document.getElementById('landmark').value.trim();
        const phone = document.getElementById('phone').value.trim();
        const wsBtn = document.getElementById('whatsapp-btn');
        
        // Regex: +53 [espacio] 8 d√≠gitos
        const phoneRegex = /^\+53\s\d{8}$/;
        const isPhoneValid = phoneRegex.test(phone);

        // Feedback visual de error
        const phoneInput = document.getElementById('phone');
        if (phone.length > 0 && !isPhoneValid) {
            phoneInput.classList.add('error');
        } else {
            phoneInput.classList.remove('error');
        }

        if(name.length > 2 && addr.length > 5 && land.length > 2 && isPhoneValid && cart.length > 0) {
            wsBtn.style.display = 'block';
            
            const total = document.getElementById('total-price').innerText;
            // Generar lista limpia
            const itemsStr = cart.map(i => {
                let str = `‚Ä¢ ${i.nombre}`;
                if(i.tamano) str += ` (${i.tamano})`;
                if(i.extras.length > 0) str += ` [+ ${i.extras.map(e => e.nombre).join(', ')}]`;
                return str;
            }).join('%0A');
            
            let msg = `*üçï NUEVO PEDIDO WEB*%0A%0A`;
            msg += `üë§ *Cliente:* ${name}%0A`;
            msg += `üìç *Direcci√≥n:* ${addr}%0A`;
            msg += `üó∫Ô∏è *Ref:* ${land}%0A`;
            msg += `üì± *Tel:* ${phone}%0A%0A`;
            msg += `*üßæ Detalle:*%0A${itemsStr}%0A%0A`;
            msg += `üí∞ *TOTAL A PAGAR: ${total}*`;

            wsBtn.href = `https://wa.me/${WHATSAPP_NUMBER}?text=${msg}`;
        } else {
            wsBtn.style.display = 'none';
        }
    }

    function showToast() {
        const t = document.getElementById('toast');
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 2500);
    }

    // --- ESTADO DEL NEGOCIO ---
    function checkStatus() {
        const h = new Date().getHours();
        const open = h >= 9 && h < 24; // 9am a 12pm
        const el = document.getElementById('business-status');
        if (open) {
            el.innerHTML = `<div class="status-dot"></div> Abierto ahora`;
            el.className = `status-badge status-open`;
        } else {
            el.innerHTML = `<div class="status-dot"></div> Cerrado`;
            el.className = `status-badge status-closed`;
        }
    }

    // Inicializar
    checkStatus();
</script>

</body>
</html>
